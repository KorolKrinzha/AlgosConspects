## Сортировки - Лекция

## Быстрая сортировка

0. Рассмотрим на примере массива [3,4,10,1,2,8,11,18]
1. Выбираем опорный элемент (pivot) - элемент 8
2. Делим массив на две части: меньше опорного и больше опорного
[3,4,1,2,8] [10,11,18]
3. Повторяем шаги 1 и 2 для каждой части
- pivot = 2: [3,4,1,2,8] -> [1,2] [3,4,8] 
- pivot = 11: [10,11,18] -> [10] [11,18]
4. Повторяем действия, пока не получим массивы из одного элемента
[1] [2] [3] [4] [8] [10] [11] [18]
5. Соединяем массивы в один

### Про разбиение

Мы хотим делать такие разбиение, чтобы была асимптотика в среднем O(n log n).

Это когда мы делим пополам, делим пополам, потом еще пополам и так далее... Тогда у нас будет log n слоев, и каждый слой будет работать за O(n).

Это идеальная картина мира. Выбираем меридиан, и дальше работаем с кусками массива. 

Реальность такова, что мы не можем выбрать меридиан, потому что нам неизвестно, какой элемент будет в середине.

Перечислим методы выбора опорного элемента:
1. Выбираем всегда первый элемент
2. Выбираем всегда серединный элемент
3. Выбирать среднее по трем элементам: первый, средний, последний
4. Выбирать случайный элемент

Проблема с первым методом в том, что мы можем найти массив, при котором мы будем получать O(n^2) в худшем случае. 

Пример: [1,2,3,4,5,6,7,8]
1. [1] [2,3,4,5,6,7,8]
2. [1] [2] [3,4,5,6,7,8]
3. [1] [2] [3] [4,5,6,7,8]
...
суммарно слоев n

Нашли массив, который "ломает" алгоритм.

Обычно используют 3 и 4 методы. Тогда среднее время работы будет O(n log n).

### Корректировка алгоритма быстрой сортировки

Будем сортировать на 3 массива: меньшие, большие и равные.

Пример: [1,6,2,1,4,2,3,2,2,5]
1. Выбираем опорный элемент - 2
2. Делим массив на 3 части: меньше, больше, равные
[1,1] [2,2,2,2] [6,4,3,5]
2. Группа равно уже отсортирована, поэтому ее не трогаем. поэтому рассматриваем только меньшие и большие

Экономим операции, меньше неотсортированных элементов.

### Как делить на 3 части в одном массиве?

0. [1,5,2,3,4,1,2,6,2]
1. Выбираем опорный элемент - 2
2. Два указателя: i - первый элемент после группы < и j - первый элемент после группы =
3. [1,2,5,3,4,1,2,6,2], i = 2, j = 5 
4. [1,1,5,3,4,2,6,2], i = 1, j = 5
6. [1,1,2,3,4,5,6,2], i = 2, j = 3
7. [1,1,2,2,4,5,3,6,2], i = 2, j = 4
8. [1,1,2,2,2,5,3,6,4], i = 2, j = 5

## k-ая порядковая статистика

Найти k-ый элемент в массиве.

Пример: Найти для массива [2,4,1,6,5,1,4] третью порядковую статистику.

Решение: 
1. отсортируем массив [1,1,2,4,4,5,6]
2. Третий элемент это 2
3. Ответ 2.

Как можно решить задачу: 
- сортировкой. Сложность O(n log n)
- а если нам надо решить за O(n)?

0. Пусть есть массив [2,3,1,4,2,5,3,2,6]. Надо найти 5-ую порядковую статистику.
1. Разобъем на группы: [2,1,2,2] [3,3] [4,5,6]
2. В первой группе первые 4 элемента. 
3. Во второй 2 элемента: 5-ый и 6-ой. Значит, продолжаем работать с группой ней, с группой [3,3]
3. Сортируем и получаем [3,3]. 5-ый элемент - 3.
4. Ответ 3.

А если нам надо найти 7-ую порядковую статистику?
3. Закрываем глаза на группы 1 и 2, работаем с [4,5,6]
4. Берем опорный элемент 5, разбили на 3 группы: [4] [5] [6]
5. В группе [4] содержится 7-ой элемент. 
На остальные группы закрываем глаза и получаем ответ

## Интроспективная сортировка

Пример: [1,2,3,4,5,6,7,8]
1. [1] [2,3,4,5,6,7,8]
2. [1] [2] [3,4,5,6,7,8]
3. Как не допустить O(n^2) в худшем случае?
Применим к [3,4,5,6,7,8] сортировку кучи.

Так даже в худшем случае мы не уйдем в квадрат.

Интроспективная сортировка - это быстрая сортировка, 
начиная с некоторой глубины рекурсии вместо разбиения используем сортировку кучи. 